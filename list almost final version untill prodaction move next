
/*
 ============================================================================
 Name        : Structure.c
 Author      : Nikolay Shiryaev
 Version     : List(1.0)
 Copyright   : Your copyright notice
 Description : Calculator(structures) in C
 ============================================================================
 */


// данные в списке остаются до конца работы программы тк не обговорено обратное 
#include <stdio.h>
#include <stdlib.h>



typedef struct element {
    char ch;
    char vec;
    int nubmerOfVec;
    float *value1;
    float *value2;
    struct element *next;
} element;

element *last = NULL;
element *head = NULL;







void pushEl ( FILE* inFile) {

    element *futureLast = (element*)malloc(sizeof(element));

    fscanf(inFile, " %c %c", &futureLast->ch, &futureLast->vec);
    printf("   1414 we are here %c  %c",futureLast->ch,futureLast->vec);
    if (futureLast->vec == 'v')
        fscanf(inFile, "%d", &futureLast->nubmerOfVec);
    else
        futureLast->nubmerOfVec = 1;
    futureLast->value1 = malloc(futureLast->nubmerOfVec*sizeof(float));
    futureLast->value2 = malloc(futureLast->nubmerOfVec*sizeof(float));
    for (int i = 0; i < futureLast->nubmerOfVec; i++)
        fscanf(inFile, "%f", &futureLast->value1[i]);
    for (int i = 0; i < futureLast->nubmerOfVec; i++)
        fscanf(inFile, "%f", &futureLast->value2[i]);
  //  futureLast->next = NULL;
   // last->next = futureLast;
if  (last != NULL)
{
    last->next = futureLast;
    futureLast->next = NULL;
}
else {
    head = futureLast;
  last = futureLast;
}
}


int main(void) {
    FILE *inFile, *outFile;
    inFile = fopen("source.txt","r");
    outFile = fopen("output.txt","w");


        while (!feof(inFile)){
            pushEl ( inFile);
        }
          while(head !=NULL)
          {

                         switch(head->vec)
                         {
                          case 'c' :
                              switch(head->ch)
                              {
                              case '+' :puts("   we are here ");head->value1[0] = head->value1[0] + head->value2[0];fprintf ( outFile,"this is a result %f\n", head->value1[0]);head = head->next ; break;
                              case '-' :head->value1[0] = head->value1[0] - head->value2[0];fprintf ( outFile,"this is a result %f\n", head->value1[0]); head = head->next; break;

                              case 'f' :head->value2[0] =1 ;for (int c = 1;c<=head->value1[0];c++)
                  {
                                  head->value2[0]=head->value2[0]*c;
                  }fprintf ( outFile,"this is a result %f\n", head->value2[0]);head = head->next; break;
                              case '*' :;head->value1[0] = head->value1[0] * (head->value1[0]);fprintf ( outFile,"this is a result %f\n", head->value1[0]);head = head->next ; break;
                              case '/' :;head->value1[0] = head->value1[0] / head->value2[0];fprintf ( outFile,"this is a result %f\n", head->value1[0]); head = head->next; break;
                              case '^' :;for (int c = 1;c<head->value2[0];c++)
                              {
                                  head->value1[0]= head->value1[0] *(head->value1[0]);
                              }fprintf (outFile, "this is a result %f\n", head->value1[0]);head = head->next; break;
                             }break;
                          case 'v' :  switch(head->ch)
                          {
                              case '+':
                                  for (int m = 0;m<head->nubmerOfVec;m++)
                                                          {
                                      head->value1[m]= head->value1[m] +head->value2[m];
                                                              fprintf (outFile,"%f ",head->value1[m]);
                                                          }
                                  head = head->next;break;
                              case '-':
                                  for (int m = 0;m<head->nubmerOfVec;m++)
                                      {
                                      head->value1[m]= head->value1[m] - head->value2[m];
                                          fprintf (outFile,"%f ",head->value1[m]);
                                      }
                                  head = head->next; break;
                              case '*':
                                  for (int m = 0;m<head->nubmerOfVec;m++)
                                                          {
                                      head->value1[m]= head->value1[m] * head->value2[m];
                                                              fprintf (outFile,"%f ",head->value1[m]);
                                                          }
                                  head = head->next; break;
                          }
                        }





          }



        fclose(inFile);
        fclose(outFile);
    return EXIT_SUCCESS;
}
